<html><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/><title>Component Creation · ReasonReact</title><meta name="viewport" content="width=device-width"/><meta property="og:title" content="Component Creation · ReasonReact"/><meta property="og:type" content="website"/><meta property="og:url" content="https://reasonml.github.io/reason-react/reason-react/index.html"/><meta property="og:description" content="A component template is created through `ReasonReact.statelessComponent &quot;TheComponentName&quot;`. The string being passed is for debugging purposes (the equivalent of ReactJS&#x27; [`displayName`](https://facebook.github.io/react/docs/react-component.html#displayname))."/><meta name="robots" content="noindex"/><link rel="shortcut icon" href="/reason-react/img/favicon/favicon.png"/><link rel="stylesheet" href="/reason-react/css/main.css"/><link rel="alternate" type="application/atom+xml" href="https://reasonml.github.io/reason-react/blog/atom.xml" title="ReasonReact Blog ATOM Feed"/> <link rel="alternate" type="application/rss+xml" href="https://reasonml.github.io/reason-react/blog/feed.xml" title="ReasonReact Blog RSS Feed"/><script async="" defer="" src="https://buttons.github.io/buttons.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/reason-react/"><img class="logo" src="/reason-react/img/reason-react-white.svg"/><h2 class="headerTitle">ReasonReact</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/reason-react/docs/en-UD/getting-started.html" target="_self">Docs</a></li><li><a href="/reason-react/docs/en-UD/simple.html" target="_self">Examples</a></li><li><a href="/reason-react/docs/en-UD/community.html" target="_self">Community</a></li><li><a href="/reason-react/blog" target="_self">Blog</a></li><li><a href="https://github.com/reasonml/reason-react" target="_self">GitHub</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/reason-react/img/language.svg"/>ɥsᴉlƃuƎ uʍopǝpᴉsd∩</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/reason-react/en">English</a></li><li><a href="https://crowdin.com/project/reason-react" target="_blank">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(){
          if(languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guide</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Guide</h3><ul><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/getting-started.html#content">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/reason-react.html#content">Reason React</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/intro-example.html#content">Intro Example</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/jsx.html#content">JSX</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/reason-react/docs/en-UD/component-creation.html#content">Component Creation</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/react-element.html#content">React Element</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/interop.html#content">Interop With Existing JavaScript Components</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/events.html#content">Events</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/cloneElement.html#content">cloneElement</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/children.html#content">uǝɹplᴉɥƆ ɥʇᴉʍ ƃuᴉʞɹoM</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/dom.html#content">Working with DOM</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/convert.html#content">Convert Over ReactJS Idioms</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/miscellaneous.html#content">Miscellaneous</a></li></ul></div><div class="navGroup navGroupActive"><h3>Frequently Asked Questions</h3><ul><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/common-errors.html#content">Common Type Errors</a></li><li class="navListItem"><a class="navItem" href="/reason-react/docs/en-UD/props-spread.html#content">How do I do props spreading?</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://crowdin.com/project/reason-react/en-UD" target="_blank">Translate this Doc</a><h1>Component Creation</h1></header><article><div><p>A component template is created through <code>ReasonReact.statelessComponent &quot;TheComponentName&quot;</code>. The string being passed is for debugging purposes (the equivalent of ReactJS&#x27; <a href="https://facebook.github.io/react/docs/react-component.html#displayname" target="_blank"><code>displayName</code></a>).</p><p>As an example, here&#x27;s a <code>greeting.re</code> file&#x27;s content:</p><pre class="prism language-reason"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>statelessComponent <span class="token string">&quot;Greeting&quot;</span><span class="token punctuation">;</span></pre><p>Now we&#x27;ll define the function that&#x27;s called when other files invoke <code>&lt;Greeting name=&quot;John&quot; /&gt;</code> (without JSX: <code>ReasonReact.element (Greeting.make name::&quot;John&quot; [||])</code>): the <code>make</code> function. It must return the component spec template we just defined, with functions such as <code>render</code> overridden:</p><pre class="prism language-reason"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>statelessComponent <span class="token string">&quot;Greeting&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> make <span class="token operator">::</span>name _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span> <span spellcheck="true" class="token comment">/* spread the template&#x27;s other defaults into here  */</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> _self <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>stringToElement name<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p><strong>Note</strong>: do <strong>not</strong> inline <code>let component</code> into the <code>make</code> function body like the following!</p><pre class="prism language-reason"><span class="token keyword">let</span> make _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>statelessComponent <span class="token string">&quot;Greeting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> render<span class="token punctuation">:</span> <span class="token keyword">fun</span> blabla<span class="token punctuation">}</span></pre><p>Since <code>make</code> is called at every JSX invocation, you&#x27;d be creating a fresh new component every time.</p><h3><a class="anchor" name="props"></a>Props <a class="hash-link" href="#props">#</a></h3><p>Props are just the labeled arguments of the <code>make</code> function, seen above. They can also be optional and/or have defaults, e.g. <code>let make ::name ::age=? ::className=&quot;box&quot; _children =&gt; ...</code>.</p><p>The last prop <strong>must</strong> be <code>children</code>. If you don&#x27;t use it, simply ignore it by naming it <code>_</code> or <code>_children</code>. Names starting with underscore don&#x27;t trigger compiler warnings if they&#x27;re unused.</p><p><strong>The prop name cannot be <code>ref</code> nor <code>key</code></strong>. Those are reserved, just like in ReactJS.</p><p>Following that example, you&#x27;d call that component in another file through <code>&lt;Foo name=&quot;Reason&quot; /&gt;</code>. <code>className</code>, if omitted, defaults to &quot;box&quot;. <code>age</code> defaults to <code>None</code>. If you&#x27;d like to explicitly pass <code>age</code>, simply do so: <code>&lt;Foo name=&quot;Reason&quot; age=20 /&gt;</code>.</p><h4><a class="anchor" name="neat-trick-with-props-forwarding"></a>Neat Trick with Props Forwarding <a class="hash-link" href="#neat-trick-with-props-forwarding">#</a></h4><p>Sometimes in ReactJS, you&#x27;re being given a prop from the owner that you&#x27;d like to forward directly to the child:</p><pre class="prism language-javascript"><span class="token operator">&lt;</span>Foo name<span class="token operator">=</span><span class="token string">&quot;Reason&quot;</span> age<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>age<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span></pre><p>This is a source of bugs, because <code>this.props.age</code> might be accidentally changed to a nullable number while <code>Foo</code> doesn&#x27;t expect it to be so, or vice-versa; it might be nullable before, and now it&#x27;s not and <code>Foo</code> is left with a useless null check somewhere in the render.</p><p>In Reason, if you want to explicitly pass an optional <code>ageFromProps</code> (whose type is <code>option int</code>, aka <code>None | Some int</code>), the following wouldn&#x27;t work:</p><pre class="prism language-reason"><span class="token operator">&lt;</span><span class="token constructor variable">Foo</span> name<span class="token operator">=</span><span class="token string">&quot;Reason&quot;</span> age<span class="token operator">=</span>ageFromProps <span class="token operator">/</span><span class="token operator">&gt;</span></pre><p>Because <code>age</code> expects a normal <code>int</code> when you do call <code>Foo</code> with it, not an <code>option int</code>! Naively, you&#x27;d be forced to solve this like so:</p><pre class="prism language-reason"><span class="token keyword">switch</span> ageFromProps <span class="token punctuation">{</span>
<span class="token operator">|</span> <span class="token constructor variable">None</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span><span class="token constructor variable">Foo</span> name<span class="token operator">=</span><span class="token string">&quot;Reason&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">|</span> <span class="token constructor variable">Some</span> nonNullableAge <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span><span class="token constructor variable">Foo</span> name<span class="token operator">=</span><span class="token string">&quot;Reason&quot;</span> age<span class="token operator">=</span>nonNullableAge <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span></pre><p>Cumbersome. Fortunately, here&#x27;s a better way to explicitly pass an optional value:</p><pre class="prism language-reason"><span class="token operator">&lt;</span><span class="token constructor variable">Foo</span> name<span class="token operator">=</span><span class="token string">&quot;Reason&quot;</span> age<span class="token operator">=</span><span class="token operator">?</span>ageFromProps <span class="token operator">/</span><span class="token operator">&gt;</span></pre><p>It says &quot;I understand that <code>age</code> is optional and that when I use the label I should pass an int. But I&#x27;d like to forward an <code>option</code> value explicitly&quot;. This isn&#x27;t a JSX trick we&#x27;ve made up; it&#x27;s just part of the language feature! See the section on &quot;Explicitly Passed Optional&quot; in the <a href="https://reasonml.github.io/guide/language/function/#explicitly-passed-optional" target="_blank">Reason docs</a>.</p><h3><a class="anchor" name="render"></a>Render <a class="hash-link" href="#render">#</a></h3><p><code>render</code> needs to return a <code>ReasonReact.reactElement</code>: <code>&lt;div /&gt;</code>, <code>&lt;MyComponent /&gt;</code>, <code>ReasonReact.nullElement</code> (the <code>null</code> you&#x27;d usually return, but this time of the <code>reactElement</code> type), <code>ReasonReact.stringToElement &quot;foo&quot;</code>, etc. Render takes the argument <code>self</code>:</p><pre class="prism language-reason"><span class="token operator">...</span>
    render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">...</span></pre><h3><a class="anchor" name="self"></a><code>self</code> <a class="hash-link" href="#self">#</a></h3><p><code>self</code> is a record that contains <code>state</code>, <code>retainedProps</code>, <code>handle</code> and <code>reduce</code>.</p><p>We&#x27;ll be referring to <code>state</code>, <code>retainedProps</code> and such immediately; they&#x27;ll be explained later on.</p><h3><a class="anchor" name="callback-handlers"></a>Callback Handlers <a class="hash-link" href="#callback-handlers">#</a></h3><h4><a class="anchor" name="callback-without-state-update"></a>Callback Without State Update <a class="hash-link" href="#callback-without-state-update">#</a></h4><p>In ReactJS, to set a new state and/or to trigger a prop callback, you&#x27;d do <code>&lt;div onClick={this.handleClick} /&gt;</code>.</p><p>In ReasonReact, <strong>if you don&#x27;t read into <code>state</code>/<code>retainedProps</code></strong> or whatever (e.g. you&#x27;re only calling a prop callback like <code>onClick</code>, and/or accessing the props arguments), you can do basically the same:</p><pre class="prism language-reason"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> make <span class="token operator">::</span>name <span class="token operator">::</span>onClick _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> click event <span class="token operator">=&gt;</span> onClick name<span class="token punctuation">;</span> <span spellcheck="true" class="token comment">/* pass the name string up to the owner */</span>
  <span class="token punctuation">{</span>
    <span class="token operator">...</span>component<span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span>click <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>If you do want to access <code>state</code>, <code>retainedProps</code> and the rest, you <strong>need</strong> to wrap the callback in an extra layer called <code>self.handle</code>:</p><pre class="prism language-reason"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> make <span class="token operator">::</span>name <span class="token operator">::</span>onClick _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> click event self <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    onClick event<span class="token punctuation">;</span>
    <span class="token class-name">Js</span><span class="token punctuation">.</span>log self<span class="token punctuation">.</span>state<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token operator">...</span>component<span class="token punctuation">,</span>
    initialState<span class="token punctuation">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
    render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>handle click<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p><strong>Note</strong> how your <code>click</code> callback now takes an extra argument, <code>self</code>. This is the same <code>self</code> which contains the latest <code>state</code>, <code>retainedProps</code> and others, described just above.</p><p>Formally, <code>self.handle</code> expects a callback that</p><ul><li>accepts the payload you&#x27;d normally directly pass to e.g. <code>handleClick</code>,</li><li>plus the argument <code>self</code>,</li><li>returns &quot;nothing&quot; (aka, <code>()</code>, aka, <code>unit</code>).</li></ul><p><strong>Note</strong>: sometimes you might be forwarding <code>handle</code> to some helper functions. Pass the whole <code>self</code> instead and <strong>annotate it</strong>. This avoids a complex <code>self</code> record type behavior. See <a href="/reason-react/docs/en-UD/common-errors.html" target="">Common Type Errors</a>. Example:</p><h4><a class="anchor" name="callback-with-state-update"></a>Callback With State Update <a class="hash-link" href="#callback-with-state-update">#</a></h4><p>You can&#x27;t update state in <code>self.handle</code>; you need to use <code>self.reduce</code> instead. See below.</p><h3><a class="anchor" name="state-actions-reducer"></a>State, Actions &amp; Reducer <a class="hash-link" href="#state-actions-reducer">#</a></h3><p>Finally, we&#x27;re getting onto stateful components!</p><p>ReasonReact stateful components are like ReactJS stateful components, except with the concept of &quot;reducer&quot; (like <a href="http://redux.js.org" target="_blank">Redux</a>) built in. If that word doesn&#x27;t mean anything to you, just think of it as a state machine. If <em>that</em> word doesn&#x27;t mean anything to you, just think: &quot;Woah this is great&quot;.</p><p>To declare a stateful ReasonReact component, instead of <code>ReasonReact.statelessComponent &quot;MyComponentName&quot;</code>, use <code>ReasonReact.reducerComponent &quot;MyComponentName&quot;</code>:</p><pre class="prism language-reason"><span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent <span class="token string">&quot;Greeting&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">::</span>name _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span><span class="token punctuation">,</span> <span spellcheck="true" class="token comment">/* here, state is an `int` */</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token string">&quot;Hello &quot;</span> <span class="token operator">^</span> name <span class="token operator">^</span> <span class="token string">&quot;. You&#x27;ve clicked the button &quot;</span> <span class="token operator">^</span> <span class="token punctuation">(</span>string_of_int self<span class="token punctuation">.</span>state<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token string">&quot; time(s)!&quot;</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>stringToElement greeting<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><h4><a class="anchor" name="initialstate"></a><code>initialState</code> <a class="hash-link" href="#initialstate">#</a></h4><p>ReactJS&#x27; <code>getInitialState</code> is called <code>initialState</code> in ReasonReact. It takes <code>unit</code> and returns the state type. The state type could be anything! An int, a string, a ref or the common record type, which you should declare <strong>right</strong> before the <code>reducerComponent</code> call:</p><pre class="prism language-javascript">type state <span class="token operator">=</span> <span class="token punctuation">{</span>counter<span class="token punctuation">:</span> int<span class="token punctuation">,</span> showPopUp<span class="token punctuation">:</span> bool<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> ReasonReact<span class="token punctuation">.</span>reducerComponent <span class="token string">&quot;Dialog&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token punctuation">:</span><span class="token punctuation">:</span>onClick _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> fun <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>counter<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> showPopUp<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Since the props are just the arguments on <code>make</code>, feel free to read into them to initialize your state based on them.</p><h4><a class="anchor" name="actions-reducer"></a>Actions &amp; Reducer <a class="hash-link" href="#actions-reducer">#</a></h4><p>In ReactJS, you&#x27;d update the state inside a callback handler, e.g.</p><pre class="prism language-javascript"><span class="token punctuation">{</span>
  <span class="token operator">...</span>
  handleClick<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  handleSubmit<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>MyForm
        onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleClick<span class="token punctuation">}</span>
        onSubmit<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>handleSubmit<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><p>In ReasonReact, you&#x27;d gather all these state-setting handlers into a single place, the component&#x27;s <code>reducer</code>! Here&#x27;s a full example, which we&#x27;ll explain in detail:</p><pre class="prism language-reason"><span class="token keyword">type</span> action <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token constructor variable">Click</span>
  <span class="token operator">|</span> <span class="token constructor variable">Toggle</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> int<span class="token punctuation">,</span> show<span class="token punctuation">:</span> bool<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent <span class="token string">&quot;MyForm&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> show<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducer<span class="token punctuation">:</span> <span class="token keyword">fun</span> action state <span class="token operator">=&gt;</span>
    <span class="token keyword">switch</span> action <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token constructor variable">Click</span> <span class="token operator">=&gt;</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span><span class="token constructor variable">Update</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token operator">|</span> <span class="token constructor variable">Toggle</span> <span class="token operator">=&gt;</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span><span class="token constructor variable">Update</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> show<span class="token punctuation">:</span> not state<span class="token punctuation">.</span>show<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">&quot;Clicked &quot;</span> <span class="token operator">^</span> string_of_int self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>count <span class="token operator">^</span> <span class="token string">&quot; times(s)&quot;</span><span class="token punctuation">;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token constructor variable">MyDialog</span>
        onClick<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">fun</span> _event <span class="token operator">=&gt;</span> <span class="token constructor variable">Click</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        onSubmit<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">fun</span> _event <span class="token operator">=&gt;</span> <span class="token constructor variable">Toggle</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>stringToElement message<span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>A few things:</p><ul><li>There&#x27;s a user-defined type called <strong><code>actions</code></strong>, named so by convention. It&#x27;s a variant of all the possible state transitions in your component. <em>In state machine terminology, this&#x27;d be a &quot;token&quot;</em>.</li><li>A user-defined <code>state</code> type, and an <code>initialState</code>. Nothing special.</li><li>The current <code>state</code> value is accessible through <code>self.state</code>, whenever <code>self</code> is passed to you as an argument of some function.</li><li>A &quot;<strong>reducer</strong>&quot;! This <a href="https://reasonml.github.io/guide/language/pattern-matching" target="_blank">pattern-matches</a> on the possible actions and specify what state update each action corresponds to. <em>In state machine terminology, this&#x27;d be a &quot;state transition&quot;</em>.</li><li>In <code>render</code>, instead of <code>self.handle</code> (which doesn&#x27;t allow state updates), you&#x27;d use <code>self.reduce</code>. <code>reduce</code> takes a callback, passing it the event (or whatever callback payload <code>onSubmit</code>/<code>onClick</code>/<code>onFoo</code> gives you from <code>MyDialog</code>) and asking for an action as the return value.</li></ul><p>So, when a click on the dialog is triggered, we send the <code>Click</code> action to the reducer, which handles the <code>Click</code> case by returning the new state that increment a counter. ReasonReact takes the state and updates the component.</p><p><strong>Note</strong>: just like for <code>self.handle</code>, sometimes you might be forwarding <code>reduce</code> to some helper functions. Pass the whole <code>self</code> instead and <strong>annotate it</strong>. This avoids a complex <code>self</code> record type behavior. See <a href="/reason-react/docs/en-UD/common-errors.html" target="">Common Type Errors</a>. Example:</p><h4><a class="anchor" name="state-update-through-reducer"></a>State Update Through Reducer <a class="hash-link" href="#state-update-through-reducer">#</a></h4><p>Notice the return value of <code>reducer</code>? The <code>ReasonReact.Update</code> part. Instead of returning a bare new state, we ask you to return the state wrapped in this &quot;update&quot; variant. Here are its possible values:</p><ul><li><code>ReasonReact.NoUpdate</code>: don&#x27;t do a state update.</li><li><code>ReasonReact.Update state</code>: update the state.</li><li><code>ReasonReact.SideEffects (self =&gt; unit)</code>: no state update, but trigger a side-effect, e.g. <code>ReasonReact.SideEffects (fun _self =&gt; Js.log &quot;hello!&quot;)</code>.</li><li><code>ReasonReact.UpdateWithSideEffects state (self =&gt; unit)</code>: update the state, <strong>then</strong> trigger a side-effect.</li></ul><p><em>If you&#x27;re a power user, there&#x27;s also <code>SilentUpdate</code> and <code>SilentUpdateWithSideEffects</code>. See reasonReact.rei to see what they do. Don&#x27;t use them if you&#x27;re trying to update a ref/timer/subscription/any other instance variable</em>.</p><h5><a class="anchor" name="important-notes"></a>Important Notes <a class="hash-link" href="#important-notes">#</a></h5><p><strong>Please read through all these points</strong>, if you want to fully take advantage of <code>reducer</code> and avoid future ReactJS Fiber race condition problems.</p><ul><li>The <code>action</code> type&#x27;s variants can carry a payload: <code>onClick=(self.reduce (fun data =&gt; Click data.foo))</code>.</li><li>Don&#x27;t pass the whole event into the action variant&#x27;s payload. ReactJS events are pooled; by the time you intercept the action in the <code>reducer</code>, the event&#x27;s already recycled.</li><li><code>reducer</code> must be pure (not to be confused with <code>self.reduce</code>, which can be impure)! Don&#x27;t do side-effects in them directly. You&#x27;ll thank us when we enable the upcoming concurrent React (Fiber). Use <code>SideEffects</code> or <code>UpdateWithSideEffects</code> to enqueue a side-effect. The side-effect (the callback) will be executed after the state setting, but before the next render.</li><li>If you need to do e.g. <code>ReactEventRe.BlablaEvent.preventDefault event</code>, do it in <code>self.reduce</code>, before returning the action type. Again, <code>reducer</code> must be pure.</li><li>If your state only holds instance variables, it also means (by the convention in the instance variables section) that your component only contains <code>self.handle</code>, no <code>self.reduce</code>. You still needs to specify a <code>reducer</code> like so: <code>reducer: fun () _state =&gt; ReasonReact.NoUpdate</code>. Otherwise you&#x27;ll get a <code>variable cannot be generalized</code> type error.</li></ul><h4><a class="anchor" name="async-state-setting"></a>Async State Setting <a class="hash-link" href="#async-state-setting">#</a></h4><p>In ReactJS, you could use <code>setState</code> inside a callback, like so:</p><pre class="prism language-javascript"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>In ReasonReact, since the new state, if any, is returned from the <code>reducer</code>, the above wouldn&#x27;t work; naturally, returning a new state from a <code>setInterval</code> doesn&#x27;t make sense!</p><p>Instead, you&#x27;d do:</p><pre class="prism language-reason"><span class="token keyword">type</span> action <span class="token operator">=</span>
  <span class="token operator">|</span> <span class="token constructor variable">Tick</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">:</span> int<span class="token punctuation">,</span>
  timerId<span class="token punctuation">:</span> ref <span class="token punctuation">(</span>option <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Global</span><span class="token punctuation">.</span>intervalId<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent <span class="token string">&quot;Counter&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>count<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> timerId<span class="token punctuation">:</span> ref <span class="token constructor variable">None</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducer<span class="token punctuation">:</span> <span class="token keyword">fun</span> action state <span class="token operator">=&gt;</span>
    <span class="token keyword">switch</span> action <span class="token punctuation">{</span>
    <span class="token operator">|</span> <span class="token constructor variable">Tick</span> <span class="token operator">=&gt;</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span><span class="token constructor variable">Update</span> <span class="token punctuation">{</span><span class="token operator">...</span>state<span class="token punctuation">,</span> count<span class="token punctuation">:</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  didMount<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>timerId <span class="token operator">:=</span> <span class="token constructor variable">Some</span> <span class="token punctuation">(</span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Global</span><span class="token punctuation">.</span>setInterval <span class="token punctuation">(</span>self<span class="token punctuation">.</span>reduce <span class="token punctuation">(</span><span class="token keyword">fun</span> _ <span class="token operator">=&gt;</span> <span class="token constructor variable">Tick</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span><span class="token constructor variable">NoUpdate</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>stringToElement <span class="token punctuation">(</span>string_of_int state<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Aka, creating a <code>reducer</code> handler as you would normally, and let that setInterval (or whatver async state setting you use) asynchronously call the callback returned by your <code>self.reduce</code>.</p><h3><a class="anchor" name="lifecycle-events"></a>Lifecycle Events <a class="hash-link" href="#lifecycle-events">#</a></h3><p><strong>Note that as of ReasonReact v0.2.4</strong>, you should return <code>ReasonReact.NoUpdate</code> whenever possible from the lifecycle events. In preparation for ReactJS fiber, we&#x27;ll remove the ability to return a new state from lifecycles. If you need to update state, simply send an action to <code>reducer</code> and handle it correspondingly: <code>self.reduce (fun () =&gt; DidMountUpdate) ()</code>.</p><p>ReasonReact supports the usuals:</p><pre class="prism language-reason">didMount<span class="token punctuation">:</span> self <span class="token operator">=&gt;</span> update state

willReceiveProps<span class="token punctuation">:</span> self <span class="token operator">=&gt;</span> state

shouldUpdate<span class="token punctuation">:</span> oldAndNewSelf <span class="token operator">=&gt;</span> bool

willUpdate<span class="token punctuation">:</span> oldAndNewSelf <span class="token operator">=&gt;</span> unit

didUpdate<span class="token punctuation">:</span> oldAndNewSelf <span class="token operator">=&gt;</span> unit

willUnmount<span class="token punctuation">:</span> self <span class="token operator">=&gt;</span> unit</pre><p>Note:</p><ul><li>We&#x27;ve dropped the <code>component</code> prefix from all these.</li><li><code>willReceiveProps</code> asks, for the return type, to be <code>state</code>, not <code>update state</code> (i.e. not <code>NoUpdate/Update/SideEffects/UpdateWithSideEffects</code>). We presume you&#x27;d always want to update the state in this lifecycle. If not, simply return the previous <code>state</code> exposed in the lifecycle argument.</li><li><code>didUpdate</code>, <code>willUnmount</code> and <code>willUpdate</code> don&#x27;t allow you to return a new state to be updated, to prevent infinite loops.</li><li><code>willMount</code> is unsupported. Use <code>didMount</code> instead.</li><li><code>didUpdate</code>, <code>willUpdate</code> and <code>shouldUpdate</code> take in a <strong><code>oldAndNewSelf</code> record</strong>, of type <code>{oldSelf: self, newSelf: self}</code>. These two fields are the equivalent of ReactJS&#x27; <code>componentDidUpdate</code>&#x27;s <code>prevProps/prevState/</code> in conjunction with <code>props/state</code>. Likewise for <code>willUpdate</code> and <code>shouldUpdate</code>.</li></ul><p><strong>Some new lifecyle methods act differently</strong>. Described below.</p><h3><a class="anchor" name="access-next-or-previous-props-retainedprops"></a>Access next or previous props: <code>retainedProps</code> <a class="hash-link" href="#access-next-or-previous-props-retainedprops">#</a></h3><p>One pattern that&#x27;s sometimes used in ReactJS is accessing a lifecyle event&#x27;s <code>prevProps</code> (<code>componentDidUpdate</code>), <code>nextProps</code> (<code>componentWillUpdate</code>), and so on. ReasonReact doesn&#x27;t automatically keep copies of previous props for you. We provide the <code>retainedProps</code> API for this purpose:</p><pre class="prism language-reason"><span class="token keyword">type</span> retainedProps <span class="token operator">=</span> <span class="token punctuation">{</span>message<span class="token punctuation">:</span> string<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>statelessComponentWithRetainedProps <span class="token string">&quot;RetainedPropsExample&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">::</span>message _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  retainedProps<span class="token punctuation">:</span> <span class="token punctuation">{</span>message<span class="token punctuation">:</span> message<span class="token punctuation">}</span><span class="token punctuation">,</span>
  didUpdate<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">{</span>oldSelf<span class="token punctuation">,</span> newSelf<span class="token punctuation">}</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldSelf<span class="token punctuation">.</span>retainedProps<span class="token punctuation">.</span>message <span class="token operator">!</span><span class="token operator">==</span> newSelf<span class="token punctuation">.</span>retainedProps<span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span spellcheck="true" class="token comment">/* do whatever sneaky imperative things here */</span>
      <span class="token class-name">Js</span><span class="token punctuation">.</span>log <span class="token string">&quot;props `message` changed!&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> _self <span class="token operator">=&gt;</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>We expose <code>ReasonReact.statelessComponentWithRetainedProps</code> and <code>ReasonReact.reducerComponentWithRetainedProps</code>. Both work like their ordinary non-retained-props counterpart, and require you to specify a new field, <code>retainedProps</code> (of whatever type you&#x27;d like) in your component&#x27;s spec in <code>make</code>.</p><h4><a class="anchor" name="willreceiveprops"></a><code>willReceiveProps</code> <a class="hash-link" href="#willreceiveprops">#</a></h4><p>Traditional ReactJS <code>componentWillReceiveProps</code> takes in a <code>nextProps</code>. We don&#x27;t have <code>nextProps</code>, since those are simply the labeled arguments in <code>make</code>, available to you in the scope. To access the <em>current</em> props, however, you&#x27;d use the above <code>retainedProps</code> API:</p><pre class="prism language-reason"><span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>someToggle<span class="token punctuation">:</span> bool<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponentWithRetainedProps <span class="token string">&quot;MyComponent&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">::</span>name _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>someToggle<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span spellcheck="true" class="token comment">/* just like state, the retainedProps field can return anything! Here it retained the `name` prop&#x27;s value */</span>
  retainedProps<span class="token punctuation">:</span> name<span class="token punctuation">,</span>
  willReceiveProps<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>retainedProps <span class="token operator">===</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">/</span><span class="token operator">*</span> previous <span class="token constructor variable">ReactJS</span> logic would be<span class="token punctuation">:</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>name <span class="token operator">===</span> nextProps<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
      <span class="token operator">...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre><h4><a class="anchor" name="willupdate"></a><code>willUpdate</code> <a class="hash-link" href="#willupdate">#</a></h4><p>ReactJS&#x27; <code>componentWillUpdate</code>&#x27;s <code>nextProps</code> is just the labeled arguments in <code>make</code>, and &quot;current props&quot; (aka <code>this.props</code>) is the props you&#x27;ve copied into <code>retainedProps</code>, accessible via <code>{oldSelf}</code>:</p><pre class="prism language-reason"><span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  willUpdate<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">{</span>oldSelf<span class="token punctuation">,</span> newSelf<span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span>
<span class="token punctuation">}</span></pre><h4><a class="anchor" name="didupdate"></a><code>didUpdate</code> <a class="hash-link" href="#didupdate">#</a></h4><p>ReactJS&#x27; <code>prevProps</code> is what you&#x27;ve synced in <code>retainedProps</code>, under <code>oldSelf</code>.</p><h4><a class="anchor" name="shouldupdate"></a><code>shouldUpdate</code> <a class="hash-link" href="#shouldupdate">#</a></h4><p>ReactJS&#x27; <code>shouldComponentUpdate</code> counterpart.</p><h3><a class="anchor" name="instance-variables"></a>Instance Variables <a class="hash-link" href="#instance-variables">#</a></h3><p>A common pattern in ReactJS is to attach extra variables onto a component&#x27;s spec:</p><pre class="prism language-javascript"><span class="token keyword">const</span> Greeting <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  intervalId<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  componentDidMount<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>intervalId <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>In reality, this is nothing but a thinly veiled way to mutate a component&#x27;s &quot;state&quot;, without triggering a re-render. ReasonReact asks you to correctly put these instance variables into your component&#x27;s <code>state</code>, into Reason <a href="https://reasonml.github.io/guide/language/mutation" target="_blank"><code>ref</code>s</a>.</p><pre class="prism language-reason"><span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  someRandomState<span class="token punctuation">:</span> option string<span class="token punctuation">,</span>
  intervalId<span class="token punctuation">:</span> ref <span class="token punctuation">(</span>option int<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span> <span spellcheck="true" class="token comment">/* remember, `component` needs to be close to `make`, and after `state` type declaration! */</span>
<span class="token keyword">let</span> make _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    someRandomState<span class="token punctuation">:</span> <span class="token constructor variable">Some</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>
    intervalId<span class="token punctuation">:</span> ref <span class="token constructor variable">None</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  didMount<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">{</span>state<span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">/* mutate the value here */</span>
    state<span class="token punctuation">.</span>intervalId <span class="token operator">:=</span> <span class="token constructor variable">Some</span> <span class="token punctuation">(</span><span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Global</span><span class="token punctuation">.</span>setInterval <span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span spellcheck="true" class="token comment">/* no extra state update needed */</span>
    <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span><span class="token constructor variable">NoUpdate</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p><strong>All your instance variables (subscriptions, refs, etc.) must be in state fields marked as a <code>ref</code></strong>. Don&#x27;t directly use a <code>mutable</code> field on the state record, use an immutable field pointing to a Reason <code>ref</code>. Why such constraint? To prepare for concurrent React which needs to manage side-effects &amp; mutations more formally. More details <a href="https://reasonml.github.io/try/?reason=C4TwDgpgBAzlC8UDeBDAXFAlgO2AGlgHsBbCASWxmBWwGMIA1FAJw2YgDMtcBfAbgBQAegBUUbIQDuUEUIEAbCMFjVg0REgFQo6KAEY8WoqQpUa9JqyjsuAJgH9hYiMQCu8lGqgADM2u86tPQwcBzMJFC08oQwruwAdFAAKgAW0OwoACZQhFy+qhABxJgA5inKAEbQZopQFSBQwGmNmKRYwADkcBAAHhC0rmqZGLJOUByu2Mh+EDwIAHzjk1AAFACUC1AAShAoMITYOyi0wPEAqmCZntBI8XczBBUec6OKyjO2CMh38Q86GABmRyiOqDKBuVSYA45PIzALYCAQTJwYCEOrpTiKE5I7g+D4BKiYeTyACEMjkM1+JHIlGodEYLCgaEQABZBCCYClCO5slUoCzyQIAFIweLREpQEkfKkmWnmBnMdliJqYOCSbnyTLYDrKdXMADWWC4kmgmTRoEgOgQqAwOHw4MGKCe1WppjpFhYtt45KAA" target="_blank">here</a> if you&#x27;re ever interested.</p><h3><a class="anchor" name="react-ref"></a>React Ref <a class="hash-link" href="#react-ref">#</a></h3><p><em>Not to be confused with Reason <code>ref</code>, the language feature that enables mutation</em>.</p><p>A ReasonReact <code>ref</code> would be just another instance variable. You&#x27;d type it as <code>ReasonReact.reactRef</code> if it&#x27;s attached to a custom component, and <code>Dom.element</code> if it&#x27;s attached to a React DOM element.</p><pre class="prism language-reason"><span class="token keyword">type</span> state <span class="token operator">=</span> <span class="token punctuation">{</span>
  isOpen<span class="token punctuation">:</span> bool<span class="token punctuation">,</span>
  mySectionRef<span class="token punctuation">:</span> ref <span class="token punctuation">(</span>option <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reactRef<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> setSectionRef theRef <span class="token punctuation">{</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>mySectionRef <span class="token operator">:=</span> <span class="token class-name">Js</span><span class="token punctuation">.</span><span class="token class-name">Null</span><span class="token punctuation">.</span>to_opt theRef<span class="token punctuation">;</span>
  <span spellcheck="true" class="token comment">/* wondering about Js.Null.to_opt? See the note below */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> component <span class="token operator">=</span> <span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>reducerComponent <span class="token string">&quot;MyPanel&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> make <span class="token operator">::</span>className<span class="token operator">=</span><span class="token string">&quot;&quot;</span> _children <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>component<span class="token punctuation">,</span>
  initialState<span class="token punctuation">:</span> <span class="token keyword">fun</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    isOpen<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    mySectionRef<span class="token punctuation">:</span> ref <span class="token constructor variable">None</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  reducer<span class="token punctuation">:</span> <span class="token operator">...</span><span class="token punctuation">,</span>
  render<span class="token punctuation">:</span> <span class="token keyword">fun</span> self <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span><span class="token constructor variable">Section1</span> ref<span class="token operator">=</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>handle setSectionRef<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></pre><p>Attaching to a React DOM element looks the same: <code>state.mySectionRef = {myDivRef: Js.Null.to_opt theRef}</code>.</p><p><strong>Note</strong> how <a href="https://github.com/facebook/react/issues/9328#issuecomment-298438237" target="_blank">ReactJS refs can be null</a>. Which is why <code>theRef</code> and <code>myDivRef</code> are converted from a <a href="http://bucklescript.github.io/bucklescript/Manual.html#_null_and_undefined" target="_blank">JS nullable</a> to an OCaml <code>option</code> (Some/None). When you use the ref, you&#x27;ll be forced to handle the null case through a <code>switch</code>, which prevents subtle errors!</p><p><strong>You must follow the instanceVars convention in the previous section for ref</strong>.</p><p>ReasonReact ref only accept callbacks. The string <code>ref</code> from ReactJS is deprecated.</p><p>We also expose an escape hatch <code>ReasonReact.refToJsObj</code> of type <code>ReasonReact.reactRef =&gt; Js.t {..}</code>, which turns your ref into a JS object you can freely use; <strong>this is only used to access ReactJS component class methods</strong>.</p><pre class="prism language-reason"><span class="token keyword">let</span> handleClick event self <span class="token operator">=&gt;</span>
  <span class="token keyword">switch</span> <span class="token operator">!</span>self<span class="token punctuation">.</span>state<span class="token punctuation">.</span>mySectionRef <span class="token punctuation">{</span>
  <span class="token operator">|</span> <span class="token constructor variable">None</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">|</span> <span class="token constructor variable">Some</span> r <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token class-name">ReasonReact</span><span class="token punctuation">.</span>refToJsObj r<span class="token punctuation">)</span><span class="token operator">#</span><span class="token operator">#</span>someMethod <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> <span spellcheck="true" class="token comment">/* I solemnly swear that I am up to no good */</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span></pre></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="jsx.html#content">← Previous</a><a class="docs-next button" href="react-element.html#content">Next →</a></div></div></div></div></div></body></html>